# SOA

Бордун Анастасия, Иванов Евгений

## Описание ##

### Cервисы ###

В отличие от ЛР №2 используются только первые два сервиса, также отсутствует front-end часть (но она может быть несложно подключена,
изменением портов для обращения на порты, соответствующие приёмным в балансировщике)

Всего используется 2 сервиса:
- 1 сервис (основной). Spring MVC REST. Tomcat 9.0.80.
- 2 сервис (побочный, обращается к первому). Spring MVC REST. Wildfly 26.1.2.

Каждый сервис работает по SSL (self signed certificates):
- 1 сервис (orgdirectory.jks)
- 2 сервис (2service.jks)

### Деплой, запуск ###

Данная работа выполнена с заданием запуска всей системы в системе Docker, поэтому
запуск не очень сложный:

0) Запустить Docker Desktop

1) Прописать команду запуска всех контейнеров и сети:
```sh
docker compose run
```

### Обращения к сервисам ###

Можно обращаться к сервисам через 

- haproxy: порт 9200
- напрямую: 
  - первые сервисы -- 9099, 9199 
  - вторые сервисы -- 9100, 9102

Первые сервисы используют одну и ту же БД, которая обновляется у каждого сервиса(при добавлении объекта из одного, другой "видит" это и вернёт информацию обо всех объектах с новым)

### Consul, Haproxy ###

Конфигурацию Haproxy можно найти в [first-service/haproxy.cfg](first-service/haproxy.cfg)

В нём настройка для server-template через консул для первых сервисов(экземпляров)

Также решить Service Discovery можно и через специальный скрипт который обращается к консулу и узнаёт о развёрнутых на нём экземплярах сервисов, далее фильтрует из них те, что относятся к первому сервису(в данном случае это все) и добавляет об этом информацию в haproxy.cfg. После надо перезапустить haproxy

Для просмотра статистики и мониторинга:

- Haproxy: http://localhost:8404/stats
- Consul: http://localhost:8500/
- Consul ручка для скрипта: http://localhost:8500/v2/api/services/


